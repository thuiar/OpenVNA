{"ast":null,"code":"import { getCurrentInstance, ref, computed, unref, watch, shallowRef, onMounted, onBeforeUnmount, provide } from 'vue';\nimport { throttle } from 'lodash-unified';\nimport { useResizeObserver } from '@vueuse/core';\nimport '../../../utils/index.mjs';\nimport '../../../tokens/index.mjs';\nimport '../../../hooks/index.mjs';\nimport { useOrderedChildren } from '../../../hooks/use-ordered-children/index.mjs';\nimport { isString } from '@vue/shared';\nimport { debugWarn } from '../../../utils/error.mjs';\nimport { carouselContextKey } from '../../../tokens/carousel.mjs';\nconst THROTTLE_TIME = 300;\nconst useCarousel = (props, emit, componentName) => {\n  const {\n    children: items,\n    addChild: addItem,\n    removeChild: removeItem\n  } = useOrderedChildren(getCurrentInstance(), \"ElCarouselItem\");\n  const activeIndex = ref(-1);\n  const timer = ref(null);\n  const hover = ref(false);\n  const root = ref();\n  const arrowDisplay = computed(() => props.arrow !== \"never\" && !unref(isVertical));\n  const hasLabel = computed(() => {\n    return items.value.some(item => item.props.label.toString().length > 0);\n  });\n  const isCardType = computed(() => props.type === \"card\");\n  const isVertical = computed(() => props.direction === \"vertical\");\n  const throttledArrowClick = throttle(index => {\n    setActiveItem(index);\n  }, THROTTLE_TIME, {\n    trailing: true\n  });\n  const throttledIndicatorHover = throttle(index => {\n    handleIndicatorHover(index);\n  }, THROTTLE_TIME);\n  function pauseTimer() {\n    if (timer.value) {\n      clearInterval(timer.value);\n      timer.value = null;\n    }\n  }\n  function startTimer() {\n    if (props.interval <= 0 || !props.autoplay || timer.value) return;\n    timer.value = setInterval(() => playSlides(), props.interval);\n  }\n  const playSlides = () => {\n    if (activeIndex.value < items.value.length - 1) {\n      activeIndex.value = activeIndex.value + 1;\n    } else if (props.loop) {\n      activeIndex.value = 0;\n    }\n  };\n  function setActiveItem(index) {\n    if (isString(index)) {\n      const filteredItems = items.value.filter(item => item.props.name === index);\n      if (filteredItems.length > 0) {\n        index = items.value.indexOf(filteredItems[0]);\n      }\n    }\n    index = Number(index);\n    if (Number.isNaN(index) || index !== Math.floor(index)) {\n      debugWarn(componentName, \"index must be integer.\");\n      return;\n    }\n    const itemCount = items.value.length;\n    const oldIndex = activeIndex.value;\n    if (index < 0) {\n      activeIndex.value = props.loop ? itemCount - 1 : 0;\n    } else if (index >= itemCount) {\n      activeIndex.value = props.loop ? 0 : itemCount - 1;\n    } else {\n      activeIndex.value = index;\n    }\n    if (oldIndex === activeIndex.value) {\n      resetItemPosition(oldIndex);\n    }\n    resetTimer();\n  }\n  function resetItemPosition(oldIndex) {\n    items.value.forEach((item, index) => {\n      item.translateItem(index, activeIndex.value, oldIndex);\n    });\n  }\n  function itemInStage(item, index) {\n    var _a, _b, _c, _d;\n    const _items = unref(items);\n    const itemCount = _items.length;\n    if (itemCount === 0 || !item.states.inStage) return false;\n    const nextItemIndex = index + 1;\n    const prevItemIndex = index - 1;\n    const lastItemIndex = itemCount - 1;\n    const isLastItemActive = _items[lastItemIndex].states.active;\n    const isFirstItemActive = _items[0].states.active;\n    const isNextItemActive = (_b = (_a = _items[nextItemIndex]) == null ? void 0 : _a.states) == null ? void 0 : _b.active;\n    const isPrevItemActive = (_d = (_c = _items[prevItemIndex]) == null ? void 0 : _c.states) == null ? void 0 : _d.active;\n    if (index === lastItemIndex && isFirstItemActive || isNextItemActive) {\n      return \"left\";\n    } else if (index === 0 && isLastItemActive || isPrevItemActive) {\n      return \"right\";\n    }\n    return false;\n  }\n  function handleMouseEnter() {\n    hover.value = true;\n    if (props.pauseOnHover) {\n      pauseTimer();\n    }\n  }\n  function handleMouseLeave() {\n    hover.value = false;\n    startTimer();\n  }\n  function handleButtonEnter(arrow) {\n    if (unref(isVertical)) return;\n    items.value.forEach((item, index) => {\n      if (arrow === itemInStage(item, index)) {\n        item.states.hover = true;\n      }\n    });\n  }\n  function handleButtonLeave() {\n    if (unref(isVertical)) return;\n    items.value.forEach(item => {\n      item.states.hover = false;\n    });\n  }\n  function handleIndicatorClick(index) {\n    activeIndex.value = index;\n  }\n  function handleIndicatorHover(index) {\n    if (props.trigger === \"hover\" && index !== activeIndex.value) {\n      activeIndex.value = index;\n    }\n  }\n  function prev() {\n    setActiveItem(activeIndex.value - 1);\n  }\n  function next() {\n    setActiveItem(activeIndex.value + 1);\n  }\n  function resetTimer() {\n    pauseTimer();\n    startTimer();\n  }\n  watch(() => activeIndex.value, (current, prev2) => {\n    resetItemPosition(prev2);\n    if (prev2 > -1) {\n      emit(\"change\", current, prev2);\n    }\n  });\n  watch(() => props.autoplay, autoplay => {\n    autoplay ? startTimer() : pauseTimer();\n  });\n  watch(() => props.loop, () => {\n    setActiveItem(activeIndex.value);\n  });\n  watch(() => props.interval, () => {\n    resetTimer();\n  });\n  watch(() => items.value, () => {\n    if (items.value.length > 0) setActiveItem(props.initialIndex);\n  });\n  const resizeObserver = shallowRef();\n  onMounted(() => {\n    resizeObserver.value = useResizeObserver(root.value, () => {\n      resetItemPosition();\n    });\n    startTimer();\n  });\n  onBeforeUnmount(() => {\n    pauseTimer();\n    if (root.value && resizeObserver.value) resizeObserver.value.stop();\n  });\n  provide(carouselContextKey, {\n    root,\n    isCardType,\n    isVertical,\n    items,\n    loop: props.loop,\n    addItem,\n    removeItem,\n    setActiveItem\n  });\n  return {\n    root,\n    activeIndex,\n    arrowDisplay,\n    hasLabel,\n    hover,\n    isCardType,\n    items,\n    handleButtonEnter,\n    handleButtonLeave,\n    handleIndicatorClick,\n    handleMouseEnter,\n    handleMouseLeave,\n    setActiveItem,\n    prev,\n    next,\n    throttledArrowClick,\n    throttledIndicatorHover\n  };\n};\nexport { useCarousel };","map":{"version":3,"mappings":"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","names":["THROTTLE_TIME","useCarousel","props","emit","componentName","children","items","addChild","addItem","removeChild","removeItem","useOrderedChildren","getCurrentInstance","activeIndex","ref","timer","hover","root","arrowDisplay","computed","arrow","unref","isVertical","hasLabel","value","some","item","label","toString","length","isCardType","type","direction","throttledArrowClick","throttle","index","setActiveItem","trailing","throttledIndicatorHover","handleIndicatorHover","pauseTimer","clearInterval","startTimer","interval","autoplay","setInterval","playSlides","loop","isString","filteredItems","filter","name","indexOf","Number","isNaN","Math","floor","debugWarn","itemCount","oldIndex","resetItemPosition","resetTimer","forEach","translateItem","itemInStage","_a","_b","_c","_d","_items","states","inStage","nextItemIndex","prevItemIndex","lastItemIndex","isLastItemActive","active","isFirstItemActive","isNextItemActive","isPrevItemActive","handleMouseEnter","pauseOnHover","handleMouseLeave","handleButtonEnter","handleButtonLeave","handleIndicatorClick","trigger","prev","next","watch","current","prev2","initialIndex","resizeObserver","shallowRef","onMounted","useResizeObserver","onBeforeUnmount","stop","provide","carouselContextKey"],"sources":["../../../../../../packages/components/carousel/src/use-carousel.ts"],"sourcesContent":["import {\n  computed,\n  getCurrentInstance,\n  onBeforeUnmount,\n  onMounted,\n  provide,\n  ref,\n  shallowRef,\n  unref,\n  watch,\n} from 'vue'\nimport { throttle } from 'lodash-unified'\nimport { useResizeObserver } from '@vueuse/core'\nimport { debugWarn, isString } from '@element-plus/utils'\nimport { carouselContextKey } from '@element-plus/tokens'\nimport { useOrderedChildren } from '@element-plus/hooks'\n\nimport type { SetupContext } from 'vue'\nimport type { CarouselItemContext } from '@element-plus/tokens'\nimport type { CarouselEmits, CarouselProps } from './carousel'\n\nconst THROTTLE_TIME = 300\n\nexport const useCarousel = (\n  props: CarouselProps,\n  emit: SetupContext<CarouselEmits>['emit'],\n  componentName: string\n) => {\n  const {\n    children: items,\n    addChild: addItem,\n    removeChild: removeItem,\n  } = useOrderedChildren<CarouselItemContext>(\n    getCurrentInstance()!,\n    'ElCarouselItem'\n  )\n\n  // refs\n  const activeIndex = ref(-1)\n  const timer = ref<ReturnType<typeof setInterval> | null>(null)\n  const hover = ref(false)\n  const root = ref<HTMLDivElement>()\n\n  // computed\n  const arrowDisplay = computed(\n    () => props.arrow !== 'never' && !unref(isVertical)\n  )\n\n  const hasLabel = computed(() => {\n    return items.value.some((item) => item.props.label.toString().length > 0)\n  })\n\n  const isCardType = computed(() => props.type === 'card')\n  const isVertical = computed(() => props.direction === 'vertical')\n\n  // methods\n  const throttledArrowClick = throttle(\n    (index: number) => {\n      setActiveItem(index)\n    },\n    THROTTLE_TIME,\n    { trailing: true }\n  )\n\n  const throttledIndicatorHover = throttle((index: number) => {\n    handleIndicatorHover(index)\n  }, THROTTLE_TIME)\n\n  function pauseTimer() {\n    if (timer.value) {\n      clearInterval(timer.value)\n      timer.value = null\n    }\n  }\n\n  function startTimer() {\n    if (props.interval <= 0 || !props.autoplay || timer.value) return\n    timer.value = setInterval(() => playSlides(), props.interval)\n  }\n\n  const playSlides = () => {\n    if (activeIndex.value < items.value.length - 1) {\n      activeIndex.value = activeIndex.value + 1\n    } else if (props.loop) {\n      activeIndex.value = 0\n    }\n  }\n\n  function setActiveItem(index: number | string) {\n    if (isString(index)) {\n      const filteredItems = items.value.filter(\n        (item) => item.props.name === index\n      )\n      if (filteredItems.length > 0) {\n        index = items.value.indexOf(filteredItems[0])\n      }\n    }\n    index = Number(index)\n    if (Number.isNaN(index) || index !== Math.floor(index)) {\n      debugWarn(componentName, 'index must be integer.')\n      return\n    }\n    const itemCount = items.value.length\n    const oldIndex = activeIndex.value\n    if (index < 0) {\n      activeIndex.value = props.loop ? itemCount - 1 : 0\n    } else if (index >= itemCount) {\n      activeIndex.value = props.loop ? 0 : itemCount - 1\n    } else {\n      activeIndex.value = index\n    }\n    if (oldIndex === activeIndex.value) {\n      resetItemPosition(oldIndex)\n    }\n    resetTimer()\n  }\n\n  function resetItemPosition(oldIndex?: number) {\n    items.value.forEach((item, index) => {\n      item.translateItem(index, activeIndex.value, oldIndex)\n    })\n  }\n\n  function itemInStage(item: CarouselItemContext, index: number) {\n    const _items = unref(items)\n    const itemCount = _items.length\n    if (itemCount === 0 || !item.states.inStage) return false\n    const nextItemIndex = index + 1\n    const prevItemIndex = index - 1\n    const lastItemIndex = itemCount - 1\n    const isLastItemActive = _items[lastItemIndex].states.active\n    const isFirstItemActive = _items[0].states.active\n    const isNextItemActive = _items[nextItemIndex]?.states?.active\n    const isPrevItemActive = _items[prevItemIndex]?.states?.active\n\n    if ((index === lastItemIndex && isFirstItemActive) || isNextItemActive) {\n      return 'left'\n    } else if ((index === 0 && isLastItemActive) || isPrevItemActive) {\n      return 'right'\n    }\n    return false\n  }\n\n  function handleMouseEnter() {\n    hover.value = true\n    if (props.pauseOnHover) {\n      pauseTimer()\n    }\n  }\n\n  function handleMouseLeave() {\n    hover.value = false\n    startTimer()\n  }\n\n  function handleButtonEnter(arrow: 'left' | 'right') {\n    if (unref(isVertical)) return\n    items.value.forEach((item, index) => {\n      if (arrow === itemInStage(item, index)) {\n        item.states.hover = true\n      }\n    })\n  }\n\n  function handleButtonLeave() {\n    if (unref(isVertical)) return\n    items.value.forEach((item) => {\n      item.states.hover = false\n    })\n  }\n\n  function handleIndicatorClick(index: number) {\n    activeIndex.value = index\n  }\n\n  function handleIndicatorHover(index: number) {\n    if (props.trigger === 'hover' && index !== activeIndex.value) {\n      activeIndex.value = index\n    }\n  }\n\n  function prev() {\n    setActiveItem(activeIndex.value - 1)\n  }\n\n  function next() {\n    setActiveItem(activeIndex.value + 1)\n  }\n\n  function resetTimer() {\n    pauseTimer()\n    startTimer()\n  }\n\n  // watch\n  watch(\n    () => activeIndex.value,\n    (current, prev) => {\n      resetItemPosition(prev)\n      if (prev > -1) {\n        emit('change', current, prev)\n      }\n    }\n  )\n  watch(\n    () => props.autoplay,\n    (autoplay) => {\n      autoplay ? startTimer() : pauseTimer()\n    }\n  )\n  watch(\n    () => props.loop,\n    () => {\n      setActiveItem(activeIndex.value)\n    }\n  )\n\n  watch(\n    () => props.interval,\n    () => {\n      resetTimer()\n    }\n  )\n\n  watch(\n    () => items.value,\n    () => {\n      if (items.value.length > 0) setActiveItem(props.initialIndex)\n    }\n  )\n\n  const resizeObserver = shallowRef<ReturnType<typeof useResizeObserver>>()\n  // lifecycle\n  onMounted(() => {\n    resizeObserver.value = useResizeObserver(root.value, () => {\n      resetItemPosition()\n    })\n    startTimer()\n  })\n\n  onBeforeUnmount(() => {\n    pauseTimer()\n    if (root.value && resizeObserver.value) resizeObserver.value.stop()\n  })\n\n  // provide\n  provide(carouselContextKey, {\n    root,\n    isCardType,\n    isVertical,\n    items,\n    loop: props.loop,\n    addItem,\n    removeItem,\n    setActiveItem,\n  })\n\n  return {\n    root,\n    activeIndex,\n    arrowDisplay,\n    hasLabel,\n    hover,\n    isCardType,\n    items,\n    handleButtonEnter,\n    handleButtonLeave,\n    handleIndicatorClick,\n    handleMouseEnter,\n    handleMouseLeave,\n    setActiveItem,\n    prev,\n    next,\n    throttledArrowClick,\n    throttledIndicatorHover,\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}