{"ast":null,"code":"import { inject, getCurrentInstance, ref, unref, onMounted, reactive, onUnmounted } from 'vue';\nimport '../../../utils/index.mjs';\nimport '../../../tokens/index.mjs';\nimport { carouselContextKey } from '../../../tokens/carousel.mjs';\nimport { debugWarn } from '../../../utils/error.mjs';\nimport { isUndefined } from '../../../utils/types.mjs';\nconst useCarouselItem = (props, componentName) => {\n  const carouselContext = inject(carouselContextKey);\n  const instance = getCurrentInstance();\n  if (!carouselContext) {\n    debugWarn(componentName, \"usage: <el-carousel></el-carousel-item></el-carousel>\");\n  }\n  if (!instance) {\n    debugWarn(componentName, \"compositional hook can only be invoked inside setups\");\n  }\n  const CARD_SCALE = 0.83;\n  const hover = ref(false);\n  const translate = ref(0);\n  const scale = ref(1);\n  const active = ref(false);\n  const ready = ref(false);\n  const inStage = ref(false);\n  const animating = ref(false);\n  const {\n    isCardType,\n    isVertical\n  } = carouselContext;\n  function processIndex(index, activeIndex, length) {\n    const lastItemIndex = length - 1;\n    const prevItemIndex = activeIndex - 1;\n    const nextItemIndex = activeIndex + 1;\n    const halfItemIndex = length / 2;\n    if (activeIndex === 0 && index === lastItemIndex) {\n      return -1;\n    } else if (activeIndex === lastItemIndex && index === 0) {\n      return length;\n    } else if (index < prevItemIndex && activeIndex - index >= halfItemIndex) {\n      return length + 1;\n    } else if (index > nextItemIndex && index - activeIndex >= halfItemIndex) {\n      return -2;\n    }\n    return index;\n  }\n  function calcCardTranslate(index, activeIndex) {\n    var _a;\n    const parentWidth = ((_a = carouselContext.root.value) == null ? void 0 : _a.offsetWidth) || 0;\n    if (inStage.value) {\n      return parentWidth * ((2 - CARD_SCALE) * (index - activeIndex) + 1) / 4;\n    } else if (index < activeIndex) {\n      return -(1 + CARD_SCALE) * parentWidth / 4;\n    } else {\n      return (3 + CARD_SCALE) * parentWidth / 4;\n    }\n  }\n  function calcTranslate(index, activeIndex, isVertical2) {\n    const rootEl = carouselContext.root.value;\n    if (!rootEl) return 0;\n    const distance = (isVertical2 ? rootEl.offsetHeight : rootEl.offsetWidth) || 0;\n    return distance * (index - activeIndex);\n  }\n  const translateItem = (index, activeIndex, oldIndex) => {\n    var _a;\n    const _isCardType = unref(isCardType);\n    const carouselItemLength = (_a = carouselContext.items.value.length) != null ? _a : Number.NaN;\n    const isActive = index === activeIndex;\n    if (!_isCardType && !isUndefined(oldIndex)) {\n      animating.value = isActive || index === oldIndex;\n    }\n    if (!isActive && carouselItemLength > 2 && carouselContext.loop) {\n      index = processIndex(index, activeIndex, carouselItemLength);\n    }\n    const _isVertical = unref(isVertical);\n    active.value = isActive;\n    if (_isCardType) {\n      if (_isVertical) {\n        debugWarn(\"Carousel\", \"vertical direction is not supported for card mode\");\n      }\n      inStage.value = Math.round(Math.abs(index - activeIndex)) <= 1;\n      translate.value = calcCardTranslate(index, activeIndex);\n      scale.value = unref(active) ? 1 : CARD_SCALE;\n    } else {\n      translate.value = calcTranslate(index, activeIndex, _isVertical);\n    }\n    ready.value = true;\n  };\n  function handleItemClick() {\n    if (carouselContext && unref(isCardType)) {\n      const index = carouselContext.items.value.findIndex(({\n        uid\n      }) => uid === instance.uid);\n      carouselContext.setActiveItem(index);\n    }\n  }\n  onMounted(() => {\n    carouselContext.addItem({\n      props,\n      states: reactive({\n        hover,\n        translate,\n        scale,\n        active,\n        ready,\n        inStage,\n        animating\n      }),\n      uid: instance.uid,\n      translateItem\n    });\n  });\n  onUnmounted(() => {\n    carouselContext.removeItem(instance.uid);\n  });\n  return {\n    active,\n    animating,\n    hover,\n    inStage,\n    isVertical,\n    translate,\n    isCardType,\n    scale,\n    ready,\n    handleItemClick\n  };\n};\nexport { useCarouselItem };","map":{"version":3,"mappings":"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","names":["useCarouselItem","props","componentName","carouselContext","inject","carouselContextKey","instance","getCurrentInstance","debugWarn","CARD_SCALE","hover","ref","translate","scale","active","ready","inStage","animating","isCardType","isVertical","processIndex","index","activeIndex","length","lastItemIndex","prevItemIndex","nextItemIndex","halfItemIndex","calcCardTranslate","_a","parentWidth","root","value","offsetWidth","calcTranslate","isVertical2","rootEl","distance","offsetHeight","translateItem","oldIndex","_isCardType","unref","carouselItemLength","items","Number","NaN","isActive","isUndefined","loop","_isVertical","Math","round","abs","handleItemClick","findIndex","uid","setActiveItem","onMounted","addItem","states","reactive","onUnmounted","removeItem"],"sources":["../../../../../../packages/components/carousel/src/use-carousel-item.ts"],"sourcesContent":["import {\n  getCurrentInstance,\n  inject,\n  onMounted,\n  onUnmounted,\n  reactive,\n  ref,\n  unref,\n} from 'vue'\nimport { debugWarn, isUndefined } from '@element-plus/utils'\nimport { carouselContextKey } from '@element-plus/tokens'\n\nimport type { CarouselItemProps } from './carousel-item'\n\nexport const useCarouselItem = (\n  props: CarouselItemProps,\n  componentName: string\n) => {\n  const carouselContext = inject(carouselContextKey)!\n  // instance\n  const instance = getCurrentInstance()!\n  if (!carouselContext) {\n    debugWarn(\n      componentName,\n      'usage: <el-carousel></el-carousel-item></el-carousel>'\n    )\n  }\n\n  if (!instance) {\n    debugWarn(\n      componentName,\n      'compositional hook can only be invoked inside setups'\n    )\n  }\n\n  const CARD_SCALE = 0.83\n\n  const hover = ref(false)\n  const translate = ref(0)\n  const scale = ref(1)\n  const active = ref(false)\n  const ready = ref(false)\n  const inStage = ref(false)\n  const animating = ref(false)\n\n  // computed\n  const { isCardType, isVertical } = carouselContext\n\n  // methods\n\n  function processIndex(index: number, activeIndex: number, length: number) {\n    const lastItemIndex = length - 1\n    const prevItemIndex = activeIndex - 1\n    const nextItemIndex = activeIndex + 1\n    const halfItemIndex = length / 2\n\n    if (activeIndex === 0 && index === lastItemIndex) {\n      return -1\n    } else if (activeIndex === lastItemIndex && index === 0) {\n      return length\n    } else if (index < prevItemIndex && activeIndex - index >= halfItemIndex) {\n      return length + 1\n    } else if (index > nextItemIndex && index - activeIndex >= halfItemIndex) {\n      return -2\n    }\n    return index\n  }\n\n  function calcCardTranslate(index: number, activeIndex: number) {\n    const parentWidth = carouselContext.root.value?.offsetWidth || 0\n    if (inStage.value) {\n      return (parentWidth * ((2 - CARD_SCALE) * (index - activeIndex) + 1)) / 4\n    } else if (index < activeIndex) {\n      return (-(1 + CARD_SCALE) * parentWidth) / 4\n    } else {\n      return ((3 + CARD_SCALE) * parentWidth) / 4\n    }\n  }\n\n  function calcTranslate(\n    index: number,\n    activeIndex: number,\n    isVertical: boolean\n  ) {\n    const rootEl = carouselContext.root.value\n    if (!rootEl) return 0\n\n    const distance =\n      (isVertical ? rootEl.offsetHeight : rootEl.offsetWidth) || 0\n    return distance * (index - activeIndex)\n  }\n\n  const translateItem = (\n    index: number,\n    activeIndex: number,\n    oldIndex?: number\n  ) => {\n    const _isCardType = unref(isCardType)\n    const carouselItemLength = carouselContext.items.value.length ?? Number.NaN\n\n    const isActive = index === activeIndex\n    if (!_isCardType && !isUndefined(oldIndex)) {\n      animating.value = isActive || index === oldIndex\n    }\n\n    if (!isActive && carouselItemLength > 2 && carouselContext.loop) {\n      index = processIndex(index, activeIndex, carouselItemLength)\n    }\n\n    const _isVertical = unref(isVertical)\n    active.value = isActive\n\n    if (_isCardType) {\n      if (_isVertical) {\n        debugWarn(\n          'Carousel',\n          'vertical direction is not supported for card mode'\n        )\n      }\n      inStage.value = Math.round(Math.abs(index - activeIndex)) <= 1\n      translate.value = calcCardTranslate(index, activeIndex)\n      scale.value = unref(active) ? 1 : CARD_SCALE\n    } else {\n      translate.value = calcTranslate(index, activeIndex, _isVertical)\n    }\n\n    ready.value = true\n  }\n\n  function handleItemClick() {\n    if (carouselContext && unref(isCardType)) {\n      const index = carouselContext.items.value.findIndex(\n        ({ uid }) => uid === instance.uid\n      )\n      carouselContext.setActiveItem(index)\n    }\n  }\n\n  // lifecycle\n  onMounted(() => {\n    carouselContext.addItem({\n      props,\n      states: reactive({\n        hover,\n        translate,\n        scale,\n        active,\n        ready,\n        inStage,\n        animating,\n      }),\n      uid: instance.uid,\n      translateItem,\n    })\n  })\n\n  onUnmounted(() => {\n    carouselContext.removeItem(instance.uid)\n  })\n\n  return {\n    active,\n    animating,\n    hover,\n    inStage,\n    isVertical,\n    translate,\n    isCardType,\n    scale,\n    ready,\n    handleItemClick,\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}